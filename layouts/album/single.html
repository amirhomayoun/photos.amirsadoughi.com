{{ define "main" }}
{{ $albumId := .File.BaseFileName }}
{{ range .Site.Data.albums.albums }}
    {{ if eq .id $albumId }}
    <div class="album-header">
        <div class="breadcrumb">
            <a href="/">Albums</a> / {{ .title }}
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>{{ .title }}</h1>
            <div class="view-switcher">
                <button class="view-btn" data-view="justified" title="Justified Gallery">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="4" width="9" height="6"/><rect x="13" y="4" width="9" height="6"/><rect x="2" y="12" width="6" height="8"/><rect x="10" y="12" width="5" height="8"/><rect x="17" y="12" width="5" height="8"/></svg>
                </button>
                <button class="view-btn" data-view="masonry" title="Masonry">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="2" width="9" height="7"/><rect x="13" y="2" width="9" height="10"/><rect x="2" y="11" width="9" height="11"/><rect x="13" y="14" width="9" height="8"/></svg>
                </button>
                <button class="view-btn" data-view="grid" title="Grid">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><rect x="2" y="2" width="9" height="9"/><rect x="13" y="2" width="9" height="9"/><rect x="2" y="13" width="9" height="9"/><rect x="13" y="13" width="9" height="9"/></svg>
                </button>
            </div>
        </div>
        {{ if .description }}
            <p class="album-description">{{ .description }}</p>
        {{ end }}
        <div class="album-meta">
            {{ if .date }}
                <span class="meta-item">üìÖ {{ dateFormat "January 2, 2006" .date }}</span>
            {{ end }}
            {{ if .location }}
                <span class="meta-item">üìç {{ .location }}</span>
            {{ end }}
            {{ if .photos }}
                <span class="meta-item">üì∑ {{ len .photos }} photos</span>
            {{ end }}
        </div>
        {{ if .tags }}
            <div class="tags">
                {{ range .tags }}
                    <span class="tag">{{ . }}</span>
                {{ end }}
            </div>
        {{ end }}
    </div>

    <div class="photo-grid">
        {{ range .photos }}
        {{ $width := .width | default 1600 }}
        {{ $height := .height | default 1200 }}
        {{ $aspectRatio := div (mul (float $width) 300.0) (float $height) }}
        <figure class="photo" data-pswp-width="{{ $width }}" data-pswp-height="{{ $height }}" style="flex-grow: {{ $aspectRatio }}; flex-basis: {{ $aspectRatio }}px;">
            <a href="{{ .urls.original }}"
               data-pswp-width="{{ $width }}"
               data-pswp-height="{{ $height }}"
               target="_blank">
                <img src="{{ .urls.medium }}"
                     alt="{{ .caption | default .filename }}"
                     loading="lazy">
            </a>
            {{ if or .caption .exif }}
            <figcaption>
                {{ if .caption }}
                    <p class="photo-caption">{{ .caption }}</p>
                {{ end }}
                {{ if .exif }}
                    <div class="exif">
                        {{ if .exif.camera }}
                            <span>{{ .exif.camera }}</span>
                        {{ end }}
                        {{ if .exif.lens }}
                            <span>{{ .exif.lens }}</span>
                        {{ end }}
                        {{ if and .exif.focal_length .exif.aperture .exif.shutter_speed .exif.iso }}
                            <span class="exif-settings">
                                {{ .exif.focal_length }} ‚Ä¢
                                f/{{ .exif.aperture }} ‚Ä¢
                                {{ .exif.shutter_speed }} ‚Ä¢
                                ISO {{ .exif.iso }}
                            </span>
                        {{ end }}
                    </div>
                {{ end }}
            </figcaption>
            {{ end }}
        </figure>
        {{ end }}
    </div>

    <div class="album-footer">
        <a href="/" class="back-link">‚Üê Back to Albums</a>
    </div>
    {{ end }}
{{ end }}
{{ end }}
